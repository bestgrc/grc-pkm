# 数据库优化

- 参考资料
  - [数据库优化一般思路(个人经验之谈)](https://blog.csdn.net/zhoupan301415/article/details/78257783)

## 1 建立索引

- 成本低，见效快

- 适用数据库规模在几十万到几百万之间

## 2 分库分表分区

### 2.1 分库

- 分开查询库和系统库(增删改比较频繁的表)分开

### 2.2 分表

1. 分出历史表或者归档表，用来存放历史数据
2. 根据查询条件分表
3. 使用软件分表 （如mycat）

> tips：数据量在千万到亿级时需要使用，针对大表

### 2.3 分区

- 设定好分区规则，数据在插入时会被自动插入指定区

> tips：不能抗高并发

## 3 选择数据库引擎

- mysql中比较常用的数据库引擎有两种，一种是innodb、一种是myisam 

|       innodb       |          myisam          |
| :----------------: | :----------------------: |
|       行级锁       |          表级锁          |
| 适用于频繁修改的表 | 适用于一次插入，多次查询 |

## 4 预处理

### 4.1 实时数据

- 通过对对业务的抽象，可以放在缓存里面，提升系统运行效率

### 4.2 历史数据

- 对时效性不高的复杂关联分析报表，设定定时任务在半夜执行，放入结果表，第二天看结果表。或者放入solr或者elastisearch中。

## 5 模糊查询优化

like  “%str%” 不支持索引， "str%"号是支持索引的

### 5.1 允许前匹配

- 是数据库快速定位到数据，在结果集中再进行like匹配

### 5.2 不允许前匹配

- 采用solr或者elastisearch来进行模糊匹配

## 6 读写分离

- 参考资料
  - [【mysql 读写分离】10分钟了解读写分离的作用](https://blog.csdn.net/u013421629/article/details/78793966)

| Q    | A                                                            |
| ---- | ------------------------------------------------------------ |
| what | 让主数据库处理事务性增、改、删操作,从数据库处理SELECT查询操作。 |
| why  | 解决数据库的写入，影响查询效率的问题                         |
| when | 更新少，查询多的情况                                         |

